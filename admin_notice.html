<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin - Notice & Circular Upload</title>
<meta name="viewport" content="width=device-width">

<style>
body {
    margin:0;
    font-family:Poppins, sans-serif;
    background:#eef1f6;
    display:flex;
}

/* Sidebar */
.sidebar {
    width:240px;
    background:#233465;
    color:white;
    height:100vh;
    position:fixed;
    left:0;
    top:0;
    padding-top:20px;
}
.sidebar h2{text-align:center;margin-bottom:20px;}
.sidebar a{
    display:block;
    padding:12px 20px;
    color:white;
    text-decoration:none;
    border-radius:6px;
}
.sidebar a:hover,
.sidebar a.active{background:rgba(255,255,255,0.25);}

/* Page Content */
.content {
    margin-left:240px;
    width:calc(100% - 240px);
    padding:20px;
}

.card {
    background:white;
    padding:20px;
    border-radius:10px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
    margin-bottom:20px;
}

label {
    font-weight:600;
    margin-top:12px;
    display:block;
}

input, select, textarea {
    width:100%;
    padding:10px;
    margin-top:5px;
    border-radius:6px;
    border:1px solid #ccc;
}

button {
    padding:12px;
    background:#233465;
    color:white;
    border:none;
    width:100%;
    margin-top:18px;
    border-radius:6px;
    cursor:pointer;
}
button:hover {background:#1b2854;}

.notice-item {
    background:white;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,0.08);
    margin-bottom:12px;
}

.notice-item span {
    display:block;
    font-size:14px;
    margin-bottom:4px;
}

.badge{
    display:inline-block;
    padding:3px 10px;
    border-radius:20px;
    font-size:12px;
    font-weight:600;
    margin-bottom:6px;
}
.badge.student{background:#e0e7ff;color:#3730a3;}
.badge.teacher{background:#dcfce7;color:#166534;}
.badge.both{background:#fee2e2;color:#991b1b;}

.delete-btn {
    background:#d62828;
    margin-top:8px;
}
.view-btn {
    background:#0077b6;
    margin-top:8px;
}
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
    <h2>ADMIN ERP</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="admin_notice.html" class="active">Notices</a>
    <a href="admin_holiday.html">Holidays</a>
</div>

<!-- Content -->
<div class="content">

<h2>Upload Notice / Circular</h2>

<div class="card">

    <label>Session</label>
    <select id="sessionSelect"></select>

    <label>Notice Title</label>
    <input type="text" id="titleInput" placeholder="Enter notice title">

    <label>Description</label>
    <textarea id="descInput" placeholder="Write details"></textarea>

    <!-- TARGET SELECTOR -->
    <label>Notice For</label>
    <select id="targetSelect">
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
        <option value="both">Both</option>
    </select>

    <label>Date</label>
    <input type="date" id="dateInput">

    <label>Upload PDF (Optional)</label>
    <input type="file" id="pdfInput" accept="application/pdf">

    <button onclick="uploadNotice()">Upload Notice</button>
</div>

<h2>All Notices</h2>
<div id="noticeList"></div>

</div>

<script>
const API = "https://exam-backend-117372286918.asia-south1.run.app/";

/* Load Sessions */
async function loadSessions(){
    try{
        const res = await fetch(`${API}/session/list`);
        const data = await res.json();
        sessionSelect.innerHTML = data.sessions.map(s =>
            `<option value="${s}">${s}</option>`
        ).join("");
    }catch{}
}
loadSessions();

/* Upload Notice */
async function uploadNotice(){
    const title = titleInput.value.trim();
    const description = descInput.value.trim();
    const date = dateInput.value;
    const target = targetSelect.value;
    const pdf = pdfInput.files[0];

    if(!title || !date){
        alert("âš  Title and Date are required");
        return;
    }

    let fd = new FormData();
    fd.append("title", title);
    fd.append("description", description);
    fd.append("date", date);
    fd.append("target", target); //  NEW FIELD
    if(pdf) fd.append("pdf", pdf);

    try{
        const res = await fetch(`${API}/notice/upload`, {
            method:"POST",
            body:fd
        });
        const data = await res.json();

        if(data.success){
            alert(" Notice uploaded");
            titleInput.value="";
            descInput.value="";
            dateInput.value="";
            pdfInput.value="";
            targetSelect.value="student";
            loadNotices();
        }else{
            alert(" "+data.message);
        }
    }catch(err){
        alert("Upload failed");
        console.error(err);
    }
}

/* Load Notices */
async function loadNotices(){
    try{
        const res = await fetch(`${API}/notice/list`);
        const data = await res.json();

        if(!data.success){
            noticeList.innerHTML="<p>No notices found.</p>";
            return;
        }

        noticeList.innerHTML="";
        data.notices.forEach(n=>{
            noticeList.innerHTML += `
            <div class="notice-item">
                <span class="badge ${n.target}">
                    ${n.target.toUpperCase()}
                </span>
                <span><b>${n.title}</b></span>
                <span>${n.description || ""}</span>
                <span>Date: ${n.date}</span>
                ${n.file ? `<button class="view-btn" onclick="viewNotice('${n.file}')">View PDF</button>` : ""}
                <button class="delete-btn" onclick="deleteNotice('${n.id}')">Delete</button>
            </div>`;
        });
    }catch(e){
        noticeList.innerHTML="<p>Error loading notices</p>";
    }
}
loadNotices();

/* View */
function viewNotice(file){
    window.open(`${API}/notice/get-file/${file}`,"_blank");
}

/* Delete */
async function deleteNotice(id){
    if(!confirm("Delete this notice?")) return;
    const res = await fetch(`${API}/notice/delete/${id}`,{method:"DELETE"});
    const d = await res.json();
    if(d.success){
        alert("Deleted");
        loadNotices();
    }
}
</script>

</body>
</html>





