<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Holiday Manager - Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Poppins,sans-serif;
    background:#f4f6f9;
    display:flex;
}
.sidebar{
    width:240px;
    background:#233465;
    color:white;
    height:100vh;
    padding-top:20px;
    position:fixed;
}
.sidebar h2{text-align:center;}
.sidebar a{
    display:block;
    padding:12px 20px;
    color:white;
    text-decoration:none;
}
.sidebar a:hover{background:rgba(255,255,255,0.25);}

.content{
    margin-left:240px;
    width:calc(100% - 240px);
    padding:20px;
}
header{
    background:#233465;
    color:white;
    padding:15px;
    font-size:22px;
    border-radius:8px;
    text-align:center;
}
.card{
    background:white;
    padding:20px;
    border-radius:12px;
    max-width:700px;
    margin:25px auto;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}
label{
    font-weight:600;
    margin-top:12px;
    display:block;
}
input,select{
    width:100%;
    padding:10px;
    margin-top:6px;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    margin-top:18px;
    padding:12px;
    width:100%;
    background:#4f46e5;
    color:white;
    border:none;
    border-radius:6px;
    font-size:16px;
    cursor:pointer;
}
button:hover{background:#3730a3;}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
}
th,td{
    border:1px solid #ddd;
    padding:10px;
    text-align:center;
}
th{
    background:#233465;
    color:white;
}
.del{
    background:#dc2626;
    color:white;
    border:none;
    padding:6px 10px;
    border-radius:5px;
    cursor:pointer;
}
.del:hover{background:#b91c1c;}
</style>
</head>

<body>

<div class="sidebar">
<h2>ADMIN ERP</h2>
<a href="dashboard.html">Dashboard</a>
    <a href="admin_notice.html">Notices</a>
    <a href="admin_holiday.html" class="active">Holidays</a>
</div>

<div class="content">
<header>Academic Holiday Manager</header>

<div class="card">
<label>Session</label>
<select id="session"></select>


<label>Holiday Name</label>
<input id="name" placeholder="e.g. Diwali / Independence Day">

<label>Date</label>
<input type="date" id="date">

<button onclick="addHoliday()">âž• Add Holiday</button>
</div>

<div class="card">
<h3>Holiday List</h3>
<table>
<thead>
<tr>
    <th>Date</th>
    <th>Holiday</th>
    <th>Action</th>
</tr>
</thead>
<tbody id="holidayTable"></tbody>
</table>
</div>

</div>

<script>
const API = "https://exam-backend-117372286918.asia-south1.run.app/";

const sessionSel = document.getElementById("session");
const table = document.getElementById("holidayTable");

/* -----------------------------
   LOAD SESSIONS (SAME AS ATTENDANCE PAGE)
----------------------------- */
async function loadSessions(){
    const res = await fetch(`${API}/session/list`);
    const data = await res.json();

    sessionSel.innerHTML = `<option value="">Select Session</option>`;

    if(data.sessions && data.sessions.length){
        data.sessions.forEach(s=>{
            sessionSel.innerHTML += `<option value="${s}">${s}</option>`;
        });

        // auto select latest session
        sessionSel.value = data.sessions[0];
        loadHolidays();
    }
}

/* -----------------------------
   LOAD HOLIDAYS
----------------------------- */
async function loadHolidays(){
    const session = sessionSel.value;
    if(!session) return;

    const res = await fetch(`${API}/holiday/list?session=${session}`);
    const data = await res.json();

    table.innerHTML = "";

    if(!data.holidays || !data.holidays.length){
        table.innerHTML = `<tr><td colspan="3">No holidays added</td></tr>`;
        return;
    }

    data.holidays.forEach(h=>{
        table.innerHTML += `
        <tr>
            <td>${h.date}</td>
            <td>${h.name}</td>
            <td>
                <button class="del" onclick="deleteHoliday('${h.id}')">Delete</button>
            </td>
        </tr>`;
    });
}

sessionSel.addEventListener("change", loadHolidays);

/* -----------------------------
   ADD HOLIDAY
----------------------------- */
async function addHoliday(){
    const name = document.getElementById("name").value.trim();
    const date = document.getElementById("date").value;
    const session = sessionSel.value;

    if(!name || !date || !session){
        alert("Fill all fields");
        return;
    }

    await fetch(`${API}/holiday/add`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,date,session})
    });

    document.getElementById("name").value="";
    loadHolidays();
}

/* -----------------------------
   DELETE HOLIDAY
----------------------------- */
async function deleteHoliday(id){
    if(!confirm("Delete this holiday?")) return;
    await fetch(`${API}/holiday/delete/${id}`,{method:"DELETE"});
    loadHolidays();
}

/* INIT */
loadSessions();
</script>

</body>
</html>





