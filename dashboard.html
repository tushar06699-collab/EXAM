<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Exam ERP â€“ Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    margin:0; 
    font-family:Poppins, sans-serif; 
    background:#eef1f6; 
}
.sidebar {
    width:230px; height:100vh; background:#233465; color:#fff;
    position:fixed; left:0; top:0; padding:25px;
}
.sidebar h2 { font-size:22px; margin-bottom:30px; }
.sidebar a {
    display:block; padding:14px; margin:8px 0; color:#fff; text-decoration:none;
    border-radius:10px; font-size:15px;
}
.sidebar a.active, .sidebar a:hover { background:#1a2648; }

.main { margin-left:250px; padding:30px; }

.topbar { display:flex; justify-content:space-between; margin-bottom:30px; align-items:center; }
.topbar-left { display:flex; gap:15px; align-items:center; }
.topbar button { background:#324a87; color:white; padding:8px 16px; border:none; border-radius:8px; cursor:pointer; font-size:14px; }
.topbar button:hover { background:#1a2648; }

.cards { display:flex; gap:25px; flex-wrap:wrap; }
.card {
    background:#fff; width:260px; padding:25px; border-radius:14px;
    box-shadow:0 4px 15px rgba(0,0,0,0.1); text-align:center;
    cursor:pointer; transition:0.25s;
}
.card p { font-size:34px; font-weight:700; margin:0; color:#233465; }
.card:hover { transform:scale(1.04); }
</style>
</head>

<body>

<div class="sidebar">
    <h2>EXAM ERP</h2>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="admin_notice.html">Notices and Circular</a>
        <a href="admin_attendence.html">Attendance</a>
    <a href="subject_add.html">School Corner</a>
    <a href="exam_create.html">Pre Exam Corner</a>
    <a href="exam_paper.html">Exams Corner</a>
    <a href="result_upload.html">Post Exam Corner</a>
</div>

<div class="main">

    <div class="topbar">
        <div class="topbar-left">
    <h1>Dashboard</h1>
    <label>Session:</label>
    <select id="sessionSelect"></select>
    <!-- New Manage Sessions button -->
    <button id="manageSessionBtn" style="margin-left:10px;">Manage Sessions</button>
</div>

        <button id="logoutBtn">Logout</button>
    </div>

    <!-- Cards -->
    <div class="cards">

        <div class="card" onclick="location.href='exam_list.html'">
            <h3>Total Exams</h3>
            <p id="examCount">0</p>
        </div>

        <div class="card" onclick="location.href='class_list.html'">
            <h3>Total Classes</h3>
            <p id="classCount">0</p>
        </div>

        <div class="card" onclick="location.href='student_list.html'">
            <h3>Total Students</h3>
            <p id="studentCount">0</p>
        </div>

    </div>

</div>

<script>
const STUDENT_API = "https://students-backend-8mup.onrender.com";
const EXAM_API = "https://exam-backend-ko0t.onrender.com"; 
const FEE_API = "https://fee-backend-ntas.onrender.com";

document.getElementById("manageSessionBtn").onclick = () => {
    window.location.href = "session_manage.html"; // change if your page name is different
};

let currentSession = localStorage.getItem("session") || "";

/* LOAD SESSIONS */
/* LOAD SESSIONS */
async function loadSessions() {
    try {
        const res = await fetch(`${EXAM_API}/session/list`);
        const data = await res.json();

        const sel = document.getElementById("sessionSelect");
        sel.innerHTML = "";

        // If no sessions exist
        if (!data.sessions || data.sessions.length === 0) {
            sel.innerHTML = `<option value="">No Sessions</option>`;
            return;
        }

        data.sessions.forEach(s => {
            let op = document.createElement("option");
            op.value = s;
            op.textContent = s;
            sel.appendChild(op);
        });

        if (!data.sessions.includes(currentSession)) {
            currentSession = data.sessions[0];
        }

        sel.value = currentSession;
        localStorage.setItem("session", currentSession);

        sel.onchange = () => {
            currentSession = sel.value;
            localStorage.setItem("session", currentSession);
            loadStats();
        };

        loadStats();
    } catch(e) {
        console.error("Session load error", e);
        alert("Failed to load sessions");
    }
}


/* LOAD ALL STATS */
function loadStats() {
    loadStudentCount();
    loadClassCount();
    loadExamCount();
}


/* ðŸ”µ STUDENT COUNT */
async function loadStudentCount() {
    try {
        const res = await fetch(`${STUDENT_API}/students`);
        const students = await res.json();

        document.getElementById("studentCount").textContent = students.length;

    } catch(e) {
        console.error(e);
        document.getElementById("studentCount").textContent = 0;
    }
}


/* ðŸŸ¢ CLASS COUNT (UNIQUE CLASSES) */
async function loadClassCount() {
    try {
        const res = await fetch(`${STUDENT_API}/students`);
        const students = await res.json();

        const unique = new Set();

        students.forEach(s => {
            let cls = s.class_name || s.class;
            if (cls) unique.add(cls.trim());
        });

        document.getElementById("classCount").textContent = unique.size;

    } catch(e) {
        console.error(e);
        document.getElementById("classCount").textContent = 0;
    }
}


/* ðŸ”´ EXAM COUNT */
async function loadExamCount() {
    try {
        const res = await fetch(`${EXAM_API}/exam/list-all`);
        const data = await res.json();

        if (!data.success) {
            document.getElementById("examCount").textContent = 0;
            return;
        }

        const exams = data.exams.filter(e => e.session === currentSession);

        document.getElementById("examCount").textContent = exams.length;

    } catch (e) {
        console.error(e);
        document.getElementById("examCount").textContent = 0;
    }
}


/* LOGOUT BUTTON */
document.getElementById("logoutBtn").onclick = () => {
    localStorage.removeItem("session");
    window.location.href = "index.html";
};


window.onload = loadSessions;
</script>

</body>
</html>
